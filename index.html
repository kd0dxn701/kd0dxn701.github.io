<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Snow Forecast Model</title>
  <style>
    :root{ --bg:#0b1220; --card:#121a2b; --muted:#97a3b6; --text:#e8eef9; --accent:#4da3ff; --ok:#2bd4a3; --warn:#ffd166; --danger:#ff7b7b; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      background: radial-gradient(1200px 800px at 20% -10%, #14203b 0, #0b1220 50%, #060a14 100%);
      color:var(--text);
    }
    header{ padding:32px 16px; text-align:center; }
    header h1{ margin:0 0 8px; font-size:clamp(24px,3vw,36px); letter-spacing:.2px }
    header p{ margin:0; color:var(--muted) }
    .wrap{ max-width:980px; margin:0 auto; padding:16px }
    .panel{
      background:linear-gradient(180deg,#151f35,#10192b);
      border:1px solid #1f2b46; border-radius:18px; padding:18px;
      box-shadow:0 8px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.02);
    }
    .grid{ display:grid; gap:14px; grid-template-columns: repeat(12, 1fr); align-items:end; }
    .col-4{ grid-column:span 4 } .col-6{ grid-column:span 6 } .col-12{ grid-column:span 12 }
    @media (max-width:800px){ .col-4,.col-6{ grid-column:span 12 } }

    label{ display:block; font-size:14px; color:var(--muted); margin:0 0 8px 4px }
    input[type="number"], select {
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid #263453;
      background:#0e1524; color:var(--text); outline:none; font-size:16px;
      transition:border-color .2s ease, box-shadow .2s ease;
    }
    input[type="number"]:focus, select:focus{ border-color:var(--accent); box-shadow:0 0 0 4px rgba(77,163,255,.12) }
    button{
      padding:13px 16px; border:0; border-radius:12px; font-weight:600; cursor:pointer;
      background:linear-gradient(180deg,#59b2ff,#3a8df0); color:#041226; letter-spacing:.2px;
      box-shadow:0 10px 24px rgba(77,163,255,.25), inset 0 1px 0 rgba(255,255,255,.25);
      transition:transform .08s ease, filter .2s ease;
    }
    button:hover{ filter:brightness(1.05) } button:active{ transform:translateY(1px) }

    .result{ margin-top:16px; padding:18px; border-radius:16px;
      background:linear-gradient(180deg,#0e1424,#0b1120); border:1px solid #1f2b46; min-height:86px; }
    .badge{ display:inline-block; font-size:12px; padding:6px 10px; border-radius:999px;
      background:#0f1c34; border:1px solid #213255; color:var(--muted); margin-right:8px }
    .strong{ color:var(--ok); font-weight:700 }
    .warn{ color:var(--warn); font-weight:700 } .danger{ color:var(--danger); font-weight:700 }

    footer{ text-align:center; color:var(--muted); font-size:13px; padding:28px 12px 40px; }
    .mini{ font-size:12px; color:#90a3be }
    details.ot{ border:1px solid #1f2b46; border-radius:14px; padding:12px 12px 6px; background:#0f1628; }
    details.ot > summary{ cursor:pointer; list-style:none; display:flex; align-items:center; gap:10px; user-select:none; color:var(--muted); font-weight:600; }
    details.ot[open] > summary{ color:var(--text) }
    .switch-row{ display:grid; grid-template-columns: 1fr auto; gap:10px; align-items:center; padding:10px 8px; border-bottom:1px dashed #213255; }
    .switch-row:last-child{ border-bottom:0 }
    .switch{ position:relative; width:76px; height:28px; background:#243250; border-radius:999px; border:1px solid #2b3a5d;
      display:flex; align-items:center; justify-content:flex-start; padding:0 6px; gap:6px; cursor:pointer; user-select:none; }
    .switch input{ display:none }
    .knob{ position:absolute; top:2px; left:2px; width:24px; height:24px; border-radius:50%;
      background:#c6d3ea; transition:left .18s ease, background .2s ease; box-shadow:0 2px 6px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.35); }
    .switch input:checked + .knob{ left:50px; background:#9fe7c9 }
    .yn-label{ font-size:12px; color:#e8eef9; z-index:2; margin-left:auto; font-weight:600; }
    .switch:has(input:checked) .yn-label{ color:#9fe7c9 }

    /* Pay strip + lock */
    .paystrip{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; padding:14px; margin-bottom:14px;
      background:linear-gradient(180deg,#0e1526,#0b1220); border:1px solid #1f2b46; border-radius:14px; }
    .dim{ opacity:.55; pointer-events:none; filter:grayscale(0.2) }
  </style>
</head>
<body>
  <header>
    <h1>Snow Forecast Model</h1>
    <p>Old-Timer No-Snow cues (Yes/No) run before the wind/temperature rules.</p>
  </header>

  <!-- Stripe buy + already-paid link -->
  <div class="wrap">
    <div id="payPanel" class="panel paystrip">
      <div style="flex:1;min-width:220px">
        <strong>Unlock Full Access</strong>
        <div class="mini">Pay once; after checkout you’ll be redirected to unlock this browser.</div>
      </div>
      <a href="https://buy.stripe.com/14k4iT4vl1j82bK288" target="_blank" rel="noopener">
        <button type="button">Buy with Stripe</button>
      </a>
      <a href="./unlock.html" style="text-decoration:none">
        <button type="button" style="background:linear-gradient(180deg,#2bd4a3,#1fb88e)">Already paid? Unlock</button>
      </a>
    </div>
  </div>

  <!-- APP -->
  <div class="wrap">
    <div class="panel dim" id="appPanel">
      <div class="grid">
        <!-- Weather inputs -->
        <div class="col-4">
          <label for="temp">Temperature (°F)</label>
          <input id="temp" type="number" min="-40" max="60" step="1" value="24" />
        </div>
        <div class="col-4">
          <label for="dir">Wind Direction</label>
          <select id="dir">
            <option>North</option><option>Northeast</option><option>East</option><option>Southeast</option>
            <option>South</option><option>Southwest</option><option>West</option><option>Northwest</option>
          </select>
        </div>
        <div class="col-4">
          <label for="speed">Wind Speed (mph)</label>
          <input id="speed" type="number" min="1" max="21" step="1" value="12" />
        </div>

        <div class="col-12" style="display:flex; gap:10px; flex-wrap:wrap;">
          <span class="badge">19–24°F: full rule set</span>
          <span class="badge">≤18°F: “new version soon” message</span>
          <span class="badge">≥33°F: no accumulation</span>
        </div>

        <!-- Old-Timer cues -->
        <div class="col-12">
          <details class="ot" open>
            <summary>
              <span>Old-Timer No-Snow Cues (Yes/No)</span>
              <span id="otIndex" class="badge">Index: 0 / 10</span>
            </summary>

            <div class="switch-row"><div>High, thin clouds (cirrus/flat stratus) instead of thick, heavy clouds</div>
              <label class="switch"><input type="checkbox" id="ot_highThinClouds"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Clouds moving fast from the <strong>south or southwest</strong></div>
              <label class="switch"><input type="checkbox" id="ot_swFlow"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Bright or “watery” halo around the moon</div>
              <label class="switch"><input type="checkbox" id="ot_moonHalo"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Ground not frozen (soft/muddy)</div>
              <label class="switch"><input type="checkbox" id="ot_softGround"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Warm wind before the front (southerly/mild feel)</div>
              <label class="switch"><input type="checkbox" id="ot_warmWind"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Animals notably active (earthworms, insects, frogs calling)</div>
              <label class="switch"><input type="checkbox" id="ot_animalsActive"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>“Wet” earthy smell in the air</div>
              <label class="switch"><input type="checkbox" id="ot_wetSmell"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Heavy dew or thick frost morning <em>before</em> the system</div>
              <label class="switch"><input type="checkbox" id="ot_dewFrost"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Birds staying high/flying freely (not huddled low/silent)</div>
              <label class="switch"><input type="checkbox" id="ot_birdsHigh"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="switch-row"><div>Livestock calm (not seeking extra shelter)</div>
              <label class="switch"><input type="checkbox" id="ot_livestockCalm"><span class="knob"></span><span class="yn-label">No</span></label></div>

            <div class="mini" style="padding:8px 4px 0;">
              Rule of thumb: Index ≥ <span class="danger"><strong>6</strong></span> → rain/no sticking likely; Index 3–5 → snow possible but lower/slushy.
            </div>
          </details>
        </div>

        <div class="col-12" style="display:flex; gap:10px; flex-wrap:wrap;">
          <button id="go">Get Forecast</button>
          <div class="mini">Changes apply instantly, but you can also click the button.</div>
        </div>

        <div class="col-12">
          <div id="output" class="result">
            Try it: set <span class="strong">Northeast @ 12–21 mph</span> to see heavy-snow messaging — then flip several Old-Timer cues to see how the message adapts.
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div>© <span id="owner">Wayne Adams</span> holds the copyright to this forecasting logic. For support or licensing, email <strong>sonfire1@mail.com</strong>. Disclaimer: This forecast model is an independent research project and is provided for educational and informational purposes only. It is not an official National Weather Service (NWS) or government forecast. For official weather warnings, watches, and advisories, consult the NWS or your local emergency management agency.</div>
  </footer>

  <!-- ================= JAVASCRIPT (your model lives here) ================= -->
  <script>
    // --- paywall / lock ------------------------------------------------------
    const PAID_FLAG = "snow_paid_v1";
    function setLocked(locked){
      const app = document.getElementById("appPanel");
      if (locked) app.classList.add("dim"); else app.classList.remove("dim");
      const ids = ["temp","dir","speed","go","ot_highThinClouds","ot_swFlow","ot_moonHalo","ot_softGround",
        "ot_warmWind","ot_animalsActive","ot_wetSmell","ot_dewFrost","ot_birdsHigh","ot_livestockCalm"];
      ids.forEach(id => { const el = document.getElementById(id); if (el) el.disabled = locked; });
      const out = document.getElementById("output");
      if (locked) out.innerHTML = `<div><strong>Locked:</strong> Please purchase to unlock the model in this browser.</div>`;
      // Hide the pay panel if already unlocked
      if (!locked){ const pay = document.getElementById("payPanel"); if (pay) pay.style.display = "none"; }
    }
    setLocked(localStorage.getItem(PAID_FLAG) !== "yes");

    // --- helpers -------------------------------------------------------------
    const dirSet = new Set(["North","Northeast","East","Southeast","South","Southwest","West","Northwest"]);
    const NE_inches = (s) => {
      if (s >= 21) return "12 inches or more (blizzard potential if winds exceed 21 mph)";
      if (s === 20) return "11 to 12 inches";
      if (s === 19) return "10 to 11 inches";
      if (s === 18) return "9 to 10 inches";
      if (s === 17) return "8 to 9 inches";
      if (s === 16) return "8 to 9 inches";
      if (s === 15) return "7 to 8 inches";
      if (s === 14) return "7 to 8 inches";
      if (s === 13) return "7 to 8 inches";
      if (s === 12) return "7 to 8 inches";
      if (s === 11) return "6 to 7 inches";
      if (s === 10) return "5 to 6 inches";
      if (s === 9)  return "5 to 6 inches";
      if (s === 8)  return "4 to 5 inches";
      if (s === 7)  return "3 to 4 inches";
      if (s === 6)  return "3 to 4 inches";
      if (s === 5)  return "2 to 3 inches";
      if (s === 4)  return "2 to 3 inches";
      if (s === 3)  return "1 to 2 inches";
      if (s === 2)  return "1 to 2 inches";
      return "1 to 2 inches"; // s === 1
    };
    const N_inches = (s) => {
      if (s >= 21) return "9 to 10 inches";
      if (s === 20) return "8 to 9 inches";
      if (s === 19) return "6 to 7 inches";
      if (s === 18) return "5 to 6 inches";
      if (s === 17) return "5 to 6 inches";
      if (s === 16) return "5 to 6 inches";
      if (s === 15) return "5 to 6 inches";
      if (s === 14) return "4 to 5 inches";
      if (s === 13) return "4 to 5 inches";
      if (s === 12) return "3 to 4 inches";
      if (s === 11) return "3 to 4 inches";
      if (s === 10) return "2 to 3 inches";
      if (s === 9)  return "2 to 3 inches";
      if (s === 8)  return "2 to 3 inches";
      if (s === 7)  return "2 to 3 inches";
      if (s === 6)  return "1 to 2 inches";
      if (s === 5)  return "1 to 2 inches";
      if (s === 4)  return "1 inch";
      if (s === 3)  return "1 inch";
      if (s === 2)  return "1 inch";
      return "1 inch"; // s === 1
    };
    const E_phrase = (s) => {
      if (s >= 21) return "Snow begins with 2 inches of accumulation possible";
      if (s === 20 || s === 19 || s === 18) return "Snow begins with 1 to 2 inches possible";
      if (s === 2) return "Snow begins with less than 1 inch possible";
      return "Snow begins with 1 inch possible";
    };

    const otIds = [
      "ot_highThinClouds","ot_swFlow","ot_moonHalo","ot_softGround","ot_warmWind",
      "ot_animalsActive","ot_wetSmell","ot_dewFrost","ot_birdsHigh","ot_livestockCalm"
    ];
    const $ = (id)=>document.getElementById(id);
    const out = $("output");
    const otIndexEl = $("otIndex");

    function getOTIndex(){ let idx = 0; for (const id of otIds) idx += $(id).checked ? 1 : 0; return idx; }
    function updateOTIndexBadge(){ otIndexEl.textContent = `Index: ${getOTIndex()} / 10`; }
    function syncYesNoLabels(){
      otIds.forEach(id=>{
        const cb = $(id);
        const yn = cb.parentElement.querySelector('.yn-label');
        yn.textContent = cb.checked ? "Yes" : "No";
      });
    }

    function directionalLogic(dir, s){
      switch(dir){
        case "Northwest": return "Limited snow possibility with only snow flurries expected.";
        case "West":
        case "Southwest":
        case "South":
        case "Southeast": return "No snow expected.";
        case "East": return E_phrase(s) + ".";
        case "Northeast":
          return `Snow to heavy snow is likely, causing delays if not impacting travel, with ${NE_inches(s)} possible.` +
                 (s >= 21 ? " Winds greater than 21 mph can have blizzard potential." : "");
        case "North":
          return `Snow is likely; possible travel implications with ${N_inches(s)} possible.`;
        default: return "Direction not recognized.";
      }
    }

    function forecast(temp, dir, speed){
      temp = Number(temp);
      speed = Math.max(1, Math.min(21, Number(speed)||0));
      dir = (dirSet.has(dir) ? dir : "North");
      if (temp >= 33) return "No snow accumulation expected.";
      if (temp <= 18) return "New version coming soon with these forecasts, or refresh the page to get the new forecast.";
      const ot = getOTIndex();
      if (ot >= 6){
        return `Old-timer cue consensus (${ot}/10) suggests rain or non-sticking wet flakes despite cold. Expect mainly rain or a brief mix; accumulation unlikely.`;
      }
      const base = directionalLogic(dir, speed);
      if (ot >= 3 && ot <= 5){
        return `${base} However, old-timer cues (${ot}/10) lean toward marginal snow: favor the lower end of ranges with slushy/patchy accumulation and mainly wet roads.`;
      }
      return base;
    }

    function render(){
      const t = $("temp").value;
      const d = $("dir").value;
      const s = $("speed").value;
      const msg = forecast(t, d, s);
      updateOTIndexBadge();
      syncYesNoLabels();
      out.innerHTML = `
        <div style="font-size:18px; line-height:1.45">
          <div style="margin-bottom:8px"><strong>Forecast:</strong> ${msg}</div>
          <div class="mini">Inputs — Temperature: <strong>${t}°F</strong>, Direction: <strong>${d}</strong>, Wind: <strong>${s} mph</strong>, Old-Timer Index: <strong>${getOTIndex()} / 10</strong></div>
        </div>`;
    }

    $("go").addEventListener("click", render);
    ["temp","dir","speed"].forEach(id=>$(id).addEventListener("input", render));
    otIds.forEach(id=>{
      const cb = $(id);
      cb.addEventListener("change", render);
      cb.parentElement.addEventListener("keydown",(e)=>{ if (e.key === "Enter" || e.key === " ") { e.preventDefault(); cb.checked = !cb.checked; render(); }});
      cb.parentElement.setAttribute("tabindex","0");
      cb.parentElement.setAttribute("role","switch");
      cb.parentElement.setAttribute("aria-checked","false");
      cb.addEventListener("change",()=>cb.parentElement.setAttribute("aria-checked", cb.checked ? "true":"false"));
    });

    // initial draw
    render();
  </script>
</body>
</html>
